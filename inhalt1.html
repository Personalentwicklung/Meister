<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIKP - Personalentwicklung</title>
  <style>
    /* CSS von ZIP3-13.html, angepasst für Konsistenz mit inhalt1.html's JS-Elementen */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 40px 20px;
      background-color: #f0f2f5;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background-color: #ffffff;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
    }
    h1 {
      color: #1a4e8a;
      text-align: center;
      font-size: 2.2em;
      margin-bottom: 5px;
    }
    h2 {
      color: #1a4e8a;
      font-size: 1.8em;
      margin-top: 20px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .thema-navigation-bar,
    .question-navigation-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .thema-navigation-bar button,
    .question-navigation-bar button {
      padding: 8px 15px;
      background-color: #e0e0e0;
      color: #555;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background-color 0.3s ease;
    }
    .thema-navigation-bar button.active,
    .question-navigation-bar button.active {
      background-color: #007bff;
      color: white;
    }
    textarea {
      width: 100%;
      height: 150px;
      font-size: 16px;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .button { /* Allgemeiner Button-Stil, ähnlich ZIP3-13, aber für Aktions-Buttons */
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.2s ease;
    }
    .button:hover {
      background-color: #0056b3;
    }

    /* Feedback- und Musterlösung-Sektionen (an ZIP3-13-Styling angepasst, aber inhalt1.html's Klassennamen beibehalten) */
    .feedback-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-left: 5px solid #007bff;
      border-radius: 4px;
      display: none; /* Standardmäßig ausgeblendet */
    }
    .feedback-section h3 {
      color: #1a4e8a;
      margin-top: 0;
      margin-bottom: 10px;
    }
    .feedback-section ul {
      list-style: none;
      padding: 0;
    }
    .feedback-section li {
      margin-bottom: 8px;
      font-size: 15px;
      line-height: 1.4;
    }
    .feedback-ok { color: green; }
    .feedback-hinweis { color: orange; }
    .feedback-fehler { color: red; }

    .musterloesung-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0f8ff;
      border-left: 5px solid #28a745;
      border-radius: 4px;
      display: none; /* Standardmäßig ausgeblendet */
    }
    .musterloesung-section h3 {
      color: #28a745;
      margin-top: 0;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>MIKP Prüfungsvorbereitung</h1>
    <h2>Thema: Personalentwicklungsprozess</h2>
    
    <div id="pe-prozess-frage1" class="question-section" style="display: block;">
      <p id="mainQuestionText" style="font-weight: bold;"></p>
      <textarea id="antwort" placeholder="Gib hier deine Antwort ein..."></textarea>
      <br>
      <button class="button" onclick="bewerteAntwort()">Antwort prüfen</button>
      <button id="showMusterloesungBtn" class="button" style="display:none;" onclick="zeigeMusterloesung()">Musterlösung anzeigen</button>

      <div id="feedbackSection" class="feedback-section"></div>
      <div id="musterloesungSection" class="musterloesung-section"></div>
    </div>
  </div>

  <script src="index.js"></script> 
  <script>
    let aktuelleFrageDaten = null;
    let alleGeladeneFragen = {}; 

    function stemWord(word) {
      if (typeof snowballFactory !== 'function') {
        console.error("Snowball stemmer factory not found. Make sure index.js is loaded correctly.");
        return word;
      }
      const stemmer = snowballFactory('German');
      stemmer.setCurrent(word);
      stemmer.stem();
      return stemmer.getCurrent();
    }

    function normalizeText(text) {
      return text.toLowerCase()
                 .replace(/ä/g, 'ae')
                 .replace(/ö/g, 'oe')
                 .replace(/ü/g, 'ue')
                 .replace(/ß/g, 'ss')
                 .replace(/[^a-z0-9\s]/g, ' ')
                 .trim();
    }

    async function bewerteAntwort() {
      if (!aktuelleFrageDaten) {
        console.error("Keine Frage geladen.");
        return;
      }

      const antwortText = document.getElementById("antwort").value;
      const normalisierteAntwort = normalizeText(antwortText);
      const gestemmteAntwortWoerter = normalisierteAntwort.split(/\s+/).map(word => stemWord(word)).filter(word => word);

      const feedbackSection = document.getElementById("feedbackSection");
      feedbackSection.style.display = "block";
      document.getElementById("showMusterloesungBtn").style.display = "block";

      let feedbackHTML = "<h3>Feedback:</h3><ul>";
      let totalPoints = 0;
      let maxPoints = 0;

      aktuelleFrageDaten.bewertungskriterien.forEach(kriterium => {
        const gestemmteKeywords = kriterium.keywords.map(word => stemWord(normalizeText(word)));
        const kriteriumNameStemmed = stemWord(normalizeText(kriterium.name));

        let feedbackMessage = `<li class='feedback-fehler'>✘ Der Begriff "${kriterium.name}" wurde nicht genannt.</li>`;

        const keywordOrNameFound = gestemmteKeywords.some(kw => gestemmteAntwortWoerter.includes(kw)) || gestemmteAntwortWoerter.includes(kriteriumNameStemmed);
        
        if (keywordOrNameFound) {
          let relevantSentenceWords = 0;
          const firstMatchedKeyword = kriterium.keywords.find(kw => antwortText.toLowerCase().includes(normalizeText(kw))) || kriterium.name;
          const keywordIndex = antwortText.toLowerCase().indexOf(normalizeText(firstMatchedKeyword));

          if (keywordIndex !== -1) {
              const contextStart = Math.max(0, keywordIndex - 30);
              const contextEnd = Math.min(antwortText.length, keywordIndex + normalizeText(firstMatchedKeyword).length + 70);
              const contextSnippet = antwortText.substring(contextStart, contextEnd);
              relevantSentenceWords = contextSnippet.split(/\s+/).filter(word => word).length;
          } else {
              relevantSentenceWords = antwortText.split(/\s+/).filter(word => word).length;
          }

          if (relevantSentenceWords >= kriterium.minWoerterFuerBeschreibung) {
            feedbackMessage = `<li class='feedback-ok'>✅ Der Begriff "${kriterium.name}" wurde ausreichend beschrieben.</li>`;
            totalPoints += 2;
          } else {
            feedbackMessage = `<li class='feedback-hinweis'>⚠️ ${kriterium.feedback_kurz}</li>`;
            totalPoints += 1;
          }
        }

        feedbackHTML += feedbackMessage;
        maxPoints += 2;
      });

      feedbackHTML += `</ul><p><strong>Gesamtpunktzahl: ${totalPoints} / ${maxPoints}</strong></p>`;
      feedbackSection.innerHTML = feedbackHTML;
    }

    async function ladeFragen() {
      try {
        const response = await fetch('fragen_pe-prozess.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        alleGeladeneFragen = await response.json();
        // Gehen wir davon aus, dass 'pep1' die relevante Frage für diese Seite ist
        aktuelleFrageDaten = alleGeladeneFragen.find(q => q.id === 'pep1');

        if (aktuelleFrageDaten) {
          document.getElementById('mainQuestionText').innerHTML = `<strong>Frage:</strong> ${aktuelleFrageDaten.frageText}`;
          document.getElementById('musterloesungSection').innerHTML = `<h3>Musterlösung:</h3><p>${aktuelleFrageDaten.musterloesung.replace(/\n/g, '<br>')}</p>`;
        } else {
          console.error("Frage 'pep1' nicht im JSON gefunden.");
          document.getElementById('mainQuestionText').textContent = "Fehler beim Laden der Frage.";
        }
      } catch (e) {
        console.error("Fehler beim Laden der Fragen aus JSON:", e);
        document.getElementById('mainQuestionText').textContent = "Fehler beim Laden der Frage. Bitte stellen Sie sicher, dass 'fragen_pe-prozess.json' korrekt im selben Verzeichnis liegt.";
      }
    }

    function zeigeMusterloesung() {
      document.getElementById("musterloesungSection").style.display = "block";
    }

    document.addEventListener('DOMContentLoaded', ladeFragen);
  </script>
</body>
</html>
